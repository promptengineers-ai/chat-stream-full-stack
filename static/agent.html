<!DOCTYPE html>
<html>
	<head>
		<title>Prompt Engineers - Chat Agent</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="/static/assets/favicon.ico" type="image/x-icon">
		<link 
			rel="stylesheet"
			href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark-dimmed.min.css"
		>
		<link 
			rel="stylesheet" 
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
		>
		<link 
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
			rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" 
			crossorigin="anonymous"
		>
		<script 
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
			integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" 
			crossorigin="anonymous"
		></script>
		<link 
			rel="stylesheet" 
			href="/static/css/styles.css"
		>
	</head>
	<body style="background-color: #171923;">
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
			<a class="navbar-brand" href="/">
				<img src="/static/assets/icon.png" alt="" width="40px">
				Langchain - Chat Agent
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						  OpenAI
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" href="/">Chat GPT</a></li>
							<li><a class="dropdown-item" href="/functions">Chat Functions</a></li>
						</ul>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						  Langchain
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" href="/agent">Chat Agent</a></li>
						  	<li><a class="dropdown-item" href="/vectorstore">Chat Vector Store</a></li>
						</ul>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						  Docs
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" href="/docs">Swagger</a></li>
						  	<li><a class="dropdown-item" href="/redoc">Redoc</a></li>
						</ul>
					</li>
				</ul>
				<div class="ms-auto">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" href="https://github.com/promptengineers-ai/chat-stream-full-stack" target="_blank">
								<i class="fab fa-github" style="font-size: 28px; color: white;"></i>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="container-fluid p-0">
			<div class="row justify-content-center p-0">
				<div class="col-md-8 col-lg-12 p-0">
					<button 
						class="btn btn-primary" 
						style="z-index: 999; position: absolute; bottom: 60%; right: -10px; border: 0; background-color: #5E35B1;" 
						type="button" data-bs-toggle="offcanvas" 
						data-bs-target="#offcanvasExample" 
						aria-controls="offcanvasExample"
					>
						<i class="fa fa-cogs" style="translate: -3px;"></i>
					</button>
					<div 
						class="offcanvas offcanvas-end" 
						data-bs-scroll="true" 
						tabindex="-1" 
						id="offcanvasExample" 
						aria-labelledby="offcanvasExampleLabel"
						style="background-color: #2C313D; color: white;"
					>
						<div class="offcanvas-header" style="margin-right: 10px;">
						  <h5 class="offcanvas-title" id="offcanvasExampleLabel">Settings</h5>
						  <button 
							style="background-color: white;"
							type="button" 
							class="btn-close text-reset" 
							data-bs-dismiss="offcanvas" 
							aria-label="Close"
						  ></button>
						</div>
						<div class="offcanvas-body" style="margin-right: 10px;">
							<div>
								<p>Select the model type:</p>
								<select id="modelType" style="width: 100%; padding: 5px;">
									<option value="gpt-3.5-turbo">GPT 3.5</option>
									<option value="gpt-3.5-turbo-16k">GPT 3.5 16k</option>
									<option value="gpt-4">GPT 4</option>
								<!-- Add as many options as you need -->
								</select>
								<p>Set the system message:</p>
								<textarea 
									id="systemMessage" 
									rows="4" 
									style="width: 100%; padding: 5px; max-height: max-content;"
								></textarea>
								<button
									id="setSystemMessage" 
									class="btn btn-primary mt-2"
									style="background-color: #5E35B1; border-color: #5E35B1;"
								>
									Save
								</button>
							</div>
						</div>
					</div>
					<div id="chatbox" class="mx-2">
							<!-- Messages will be appended here -->
					</div>
					<form id="messageForm" class="mb-3" style="z-index: 999;">
						<div class="px-3" style="width: 100%;">
							<div class="input-group" style="width: 100%;">
								<textarea 
									rows="1"
									type="text" 
									id="userInput" 
									class="form-control" 
									placeholder="Type your message here..." 
								></textarea>
								<button 
									id="sendButton"
									type="submit" 
									class="btn btn-primary" 
									style="background-color: #5E35B1; border-color: #5E35B1;"
								>
									<i id="sendIcon" class="fa fa-paper-plane"></i>
									<div id="spinner" class="spinner-border spinner-border-sm text-light" role="status" style="display: none;"></div>
								</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<script>
			var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
			var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
			return new bootstrap.Popover(popoverTriggerEl)
			})
		</script>
		<!-- javascript -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<script src="/static/js/chat.js"></script>
		<script src="/static/js/highlight.js"></script>
		<script src="/static/js/reader.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', (event) => {
				// Set the value of the textarea
				document.getElementById('systemMessage').value = systemMessage;
				document.getElementById('modelType').value = modelType;

				// Define an array of placeholder texts
				let placeholders = [
					"Who is the current president of New Zealand?",
					"What are the most promising AI technologies of 2023?",
					"Who won the Oscar for Best Actor in 2023?",
					"Where would be the best place to go on vacation in 2023?",
						// ... add as many as you want
				];
				
				// Choose a random placeholder
				let placeholder = placeholders[Math.floor(Math.random() * placeholders.length)];
				
				// Set the placeholder
				document.getElementById('userInput').value = placeholder;
			});

			function sendChatMessage(messages, sessionID, userInput, chatbox) {
				// Show the spinner and hide the send icon
				document.getElementById('spinner').style.display = 'block';
				document.getElementById('sendIcon').style.display = 'none';
				document.getElementById('sendButton').disabled = true;

				// Get the system message and model type from localStorage
				let modelType = localStorage.getItem('modelType') || 'gpt-3.5-turbo';
				let systemMessage = localStorage.getItem('systemMessage') || 'You are a helpful assistant.';
				messages[0].content = systemMessage;
				fetch(`/chat/stream/agent`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ 
						session_id: sessionID, 
						messages: messages, 
						model: modelType,
						temperature: 0.9,
					}),
				}).then(response => {
					console.log('Server Response:', response);
					
					// Handle the event stream from the response
					let assistantMessageDiv = document.createElement('div');
					assistantMessageDiv.className = 'message assistant';
					chatbox.appendChild(assistantMessageDiv);
					
					let reader = response.body.getReader();
					readMessage(reader, userInput, assistantMessageDiv, chatbox);
				});
			}
		</script>
		<script>
			document.getElementById('userInput').addEventListener('keyup', function () {
				this.style.height = 0;
				this.style.height = this.scrollHeight + 'px';
			}, false);
		</script>
	</body>
</html>